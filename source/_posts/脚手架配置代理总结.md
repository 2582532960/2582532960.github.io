---
title: 脚手架配置代理总结
date: 2023-11-02 19:39:01
tags: [React, Vue]
categories: 前端
---

# React

## 方法一：

在 **package.json** 中追加如下配置

"proxy":"http://localhost:5000"

说明：

1. 优点：配置简单，前端请求资源时可以不加任何前缀。
2. 缺点：不能配置多个代理。
3. 工作方式：上述方式配置代理，当请求了 3000 不存在的资源时，那么该请求会转发 5000（优先匹配前端资源）

## 方法二

1. 第一步：创建代理配置文件

在 src 下创建配置文件：**src/setupProxy.js**

2. 编写 setupProxy.js 配置具体代理规则：

```javascript
const { createProxyMiddleware } = require("http-proxy-middleware");
module.exports = function (app) {
  app.use(
    "/api1", //api1是需要转发的请求(所有带有/api1前缀的请求都会转发给5000)
    createProxyMiddleware({
      target: "https://shanghe.qlu.edu.cn", //配置转发目标地址(能返回数据的服务器地址)
      changeOrigin: true, //控制服务器接收到的请求头中host字段的值
      /*
        changeOrigin设置为true时，服务器收到的请求头中的host为：localhost:5000
        changeOrigin设置为false时，服务器收到的请求头中的host为：localhost:3000
        changeOrigin默认值为false，但我们一般将changeOrigin值设为true
      */
      pathRewrite: {
        "^/api1": "",
      }, //去除请求前缀，保证交给后台服务器的是正常请求地址(必须配置)
    }),
    "/api2",
    createProxyMiddleware({
      target: "http://localhost:5001",
      changeOrigin: true,
      pathRewrite: {
        "^/api2": "",
      },
    })
  );
};
```

说明：

1. 优点：可以配置多个代理，可以灵活的控制请求是否走代理。
2. 缺点：配置繁琐，前端请求资源时必须加前缀。

# Vue

## 方法一

如果你的前端应用和后端 API 服务器没有运行在同一个主机上，你需要在开发环境下将 API 请求代理到 API 服务器。这个问题可以通过 **vue.config.js** 中的 devServer.proxy 选项来配置。

devServer.proxy 可以是一个指向开发环境 API 服务器的字符串：

```javascript
module.exports = {
  devServer: {
    proxy: "http://localhost:5000", //配置转发目标地址(能返回数据的服务器地址)
  },
};
```

## 方法二

如果你想要更多的代理控制行为，也可以使用一个 path: options 成对的对象。

```javascript
module.exports = {
  devServer: {
    proxy: {
      "/api": {
        target: "http://localhost:5000", //配置转发目标地址(能返回数据的服务器地址)
        ws: true, //用于支持websocket
        changeOrigin: true, //控制服务器接收到的请求头中host字段的值
        /*
          changeOrigin设置为true时，服务器收到的请求头中的host为：localhost:5000
          changeOrigin设置为false时，服务器收到的请求头中的host为：localhost:3000
          changeOrigin默认值为false，但我们一般将changeOrigin值设为true
        */
        pathRewrite: {
          "^/api": "",
        }, //去除请求前缀，保证交给后台服务器的是正常请求地址(必须配置)
      },
      "/demo": {
        target: "http://localhost:5001",
        ws: true,
        changeOrigin: true,
        pathRewrite: {
          "^/demo": "",
        },
      },
    },
  },
};
```

# Vite 中配置代理

在**vite.config.ts**或**vue.config.js**中添加 server.proxy 选项，用于配置代理服务器的规则。

```javascript
import {
  defineConfig
} from 'vite'
import react from '@vitejs/plugin-react-swc'或者import vue from '@vitejs/plugin-vue'

export default defineConfig({
  plugins: [react()],或者plugins: [vue()],
  server: {
    proxy: {
      '/api': {
        target: "https://shanghe.qlu.edu.cn/ecos",
        changeOrigin: true,
        rewrite: (path: string) => {
          return path.replace(/^\/api/, "");
        },
      },
      "/test": {
        target: "http://localhost:5000",
        changeOrigin: true,
        rewrite: (path: string) => {
          return path.replace(/^\/test/, "");
        },
      },
    }
  }
}
)
```
